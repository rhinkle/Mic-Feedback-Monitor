## Codebase Patterns
- Use `.venv/bin/mypy --ignore-missing-imports` for type checking
- Project uses Python 3.13 with venv at .venv/
- Main entry point is mic_monitor.py

---

## 2026-01-19 - US-001
- **What was implemented**: Project setup and dependencies
  - Created requirements.txt with rumps, sounddevice, numpy
  - Created main entry point mic_monitor.py
  - Created empty modules: audio_engine.py and settings.py
  - Added .gitignore for Python projects
- **Files changed**: requirements.txt, mic_monitor.py, audio_engine.py, settings.py, .gitignore, prd.json
- **Learnings for future iterations:**
  - This is a fresh project with no git repo, so needed to initialize git first
  - Using mypy with --ignore-missing-imports since third-party stubs aren't installed
  - Installed mypy in venv for type checking
---

## 2026-01-19 - US-002
- **What was implemented**: Settings manager module
  - Implemented SettingsManager class with full functionality
  - Settings stored at ~/Library/Application Support/MicMonitor/config.json
  - Default values: volume=50, latency_ms=20, monitoring_enabled=False
  - load() reads config or returns defaults if file missing (handles JSON errors gracefully)
  - save() writes current settings, creating directory if needed
  - Added property accessors with validation (volume 0-100, latency 5-100ms)
- **Files changed**: settings.py, prd.json
- **Learnings for future iterations:**
  - SettingsManager exposes settings via properties with getters/setters for validation
  - Config directory is auto-created in save() using mkdir(parents=True, exist_ok=True)
  - load() and save() handle file I/O; properties manage in-memory state
---

## 2026-01-19 - US-003
- **What was implemented**: Audio engine with passthrough
  - Implemented AudioEngine class with full mic-to-output passthrough
  - start() begins audio passthrough using sounddevice.Stream with callback
  - stop() stops and closes stream cleanly
  - set_volume(0-100) adjusts gain in real-time (volume/100 as multiplier)
  - Uses system default input/output devices (no explicit device param = defaults)
  - Included is_running property to check stream state
- **Files changed**: audio_engine.py, prd.json
- **Learnings for future iterations:**
  - AudioEngine uses a callback-based sd.Stream for real-time processing
  - Volume is applied as gain multiplier in _audio_callback
  - blocksize is calculated from latency_ms (sample_rate * latency_ms / 1000)
  - Stream uses mono (channels=1) and float32 dtype for processing
  - _latency_ms already exists in AudioEngine for US-004
---

## 2026-01-19 - US-004
- **What was implemented**: Audio engine latency control
  - Added set_latency(ms) method to AudioEngine class
  - Latency range constrained to 5ms-100ms using max/min clamping
  - Latency changes take effect dynamically: if stream is running, it restarts with new blocksize
  - Default latency remains 20ms (was already set in US-003)
- **Files changed**: audio_engine.py, prd.json
- **Learnings for future iterations:**
  - set_latency() dynamically restarts the stream if running to apply new buffer size
  - Latency affects blocksize calculation: blocksize = sample_rate * latency_ms / 1000
  - Both set_volume() and set_latency() use max/min clamping for validation
---
